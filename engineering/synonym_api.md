## あるべき姿(目的)

- 検索ワード(in)に対して、表記ゆれがある場合にデータベースからその表記ゆれ配列を持ってきて、その中から代表語を返す(out)

↓

- １つのリクエストに返して、１つのレスポンスを返すだけの機能

## 考えるべき項目

- severless アーキテクチャ(AWS Lambda) or アプリケーションサーバー(EC2 インスタンス)
- 表記ゆれ配列取得と代表語の選定を分けるか？
- DB に何を使うか
- 言語は何を主体に？

## severless アーキテクチャ(AWS Lambda) or アプリケーションサーバー(EC2 インスタンス)

### severless アーキテクチャ(AWS Lambda)

「非常駐型プロセス」をイベントによってトリガーするインフラストラクチャ

- メリット

  - インフラまわりの構築と管理の手間が省ける
    - 環境設定不要
    - 起動・監視不要
    - オートスケーリングしてくれる
  -  複雑になりがちなトリガーに対する処理の実行を簡単に書ける
    - アプリケーションの開発と Lambda ファンクション(トリガーに対する処理実行関数)をアップロードするだけいい。
  -  トリガーに対して起動するので、コストが抑えられる
    - リクエストのうち毎月最初の 1,000,000 件は無料。以後は 1,000,000 件のリクエストにつき 0.20 USD
  -  セキュリティに関してはブラックボックスだが、外部への露出が少ないので安全

- デメリット
  - AWS リソース(S3, DynamoDB, SQS...)と同じリージョンでなければならないという制約  
    => 特に問題なさそう。
  - ステートレスなので、 複雑な機能への使用に向かない  
    => 外部に永続的なに  データを保管するものが必要 = AWS リソース
  - タイムアウト時間が最大 300 秒まで  
    => 基本的に  簡単な機能向けなのと数秒で返すべきものなので、 仮にタイムアウト上限を越えようとも、ここの問題ではない。なんなら 5 秒まででいい

### EC2 インスタンス

- メリット

  - 複雑な処理に対応できる  
    => 今回は簡単な機能
  - コストは lembda とそんなに変わらない
  - タイムアウト時間がない  
    =>  そもそも  短時間で処理できるようにするため不要なメリット

- デメリット

  - インフラの  設定と管理が必要
  - セキュリティ管理も必要

(結論)

- Lambda が良さそう
  - 今回の API の機能規模的に適している
    - 機能規模的にインフラの管理等のコストはかけたかくない



## 表記ゆれ配列取得と代表語の選定を分けるか？

### 分ける

- メリット

  -  他に転用できる箇所がある場合に転用しやすい  
    =>  転用するところなさそう

- デメリット
  -  リポジトリを分ける必要があるため、色々と手間がかかりそう

### 分けない

- メリット

  - リポジトリを統一できるので設定や管理が楽

- デメリット
  - 他に転用できない

(結論)

- 分けない
  - 機能的に他に転用する可能性は低い 
  - 分けなくても処理の複雑さはそこまで変わらず、 Lambda にも適応できる
  - 設定などが統一されるので楽

## DB に何を使うか

(候補)

- DynamoDB
- RDS

### DynamoDB

- メリット
  - 読み書きが早い
    => ◯ 検索のたびにアクセスするのでより高速な方がいい
- デメリット
  - シンプルなデータ構造にしか使えない
    => 今回は辞書の中身なので  シンプル
  - 空文字が利用できない
    => しない
  -  ネット経由でのアクセスが必要

### RDS

- メリット
  -  テーブル結合などの複雑なデータ構造を持てる
    =>  辞書なのでテーブ結合はしない
  - SQL により操作可能
    => そこまでアドバンテージにはならない
  -  ネット経由でのアクセスが不要
- デメリット
  - lambda との相性がよくなさそう
    - 色々と設定が必要
      - lambda を VPC に配置 or RDS をグローバルに配置
        => RDS の良さが消える
      - lambda の zip ファイルに MySQL などのライブラリの配置が必要
  - スケールアップにはシステムを止める必要がある

ref: [何が違う？DynamoDB と RDS](http://blog.serverworks.co.jp/tech/2017/04/12/what_is_different_dynamodb_and_rds/)

(結論)

- DynamoDB
  - 読み書きが早い
  - テーブル結合不要なので RDS は機能過多、DynamoDB に適している
  - lambda との相性も良い
  - 頻繁にデータ更新はしない

## 言語は何を主体に？

(候補)

- lambda  ファンクションに使える言語

  > AWS Lambda は、ネイティブでは、Java、Go、PowerShell、Node.js、C#、Python、Ruby のコードをサポートしています。また、関数の作成にその他のプログラミング言語を使用できるようにするための Runtime API を提供しています。

(結論)

- Go
  - synonym API が Go で書かれている
  - serverless に

## アーキテクチャ構成の参考

- [pixta-title-translator](https://github.com/pixta-dev/pixta-title-translator)

  - lambda
  - DynamoDB
  - 言語 js

- https://dev.classmethod.jp/cloud/aws/serverless-first-dynamodb/

##  フロー想定

[WIP]
